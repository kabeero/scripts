https://github.com/puiterwijk/qemu-ovmf-secureboot


❯ pgrep -af qemu
286475 /usr/bin/qemu-system-x86_64 -machine q35,smm=on,accel=kvm -display none -no-reboot -no-user-config -nodefaults -m 768 -smp 2,sockets=2,cores=1,threads=1 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -global driver=cfi.pflash01,property=secure,value=on -drive file=/usr/share/edk2-ovmf/OVMF_CODE.secboot.fd,if=pflash,format=raw,unit=0,readonly=on -drive file=/tmp/qosb.bdvz8l66.vars,if=pflash,format=raw,unit=1,readonly=off -serial stdio -smbios type=11,value=4e32566d-8e9e-4f52-81d3-5bb9715f9727:MIIDazCCAlOgAwIBAgIUYhrSAK2YA27jh+kc8EnRJDYYJbIwDQYJKoZIhvcNAQELBQAwRTELMAkGA1UEBhMCQVUxEzARBgNVBAgMClNvbWUtU3RhdGUxITAfBgNVBAoMGEludGVybmV0IFdpZGdpdHMgUHR5IEx0ZDAeFw0yMTEyMzExMDA1MThaFw0yMjAxMzAxMDA1MThaMEUxCzAJBgNVBAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBXaWRnaXRzIFB0eSBMdGQwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC29YkYhxKs1C3SNlRyMAxBViS/IFIRX8NqE+MbHO1BYqyiO2/FhabauVqJZSdi5I2t4pcbxbxdRdzhB8626cTXBhTM5FRXCG8mrtZ0d6hIGwn3i9FoBZAqEBxTmSkoz3IOjLMBjgQDHPKm5HVvzGoNRnkY/cJoCAUNNLmuMBGzcsDKMPs1wt+/Y80TAE2E8QKCgufqKt9/wKphP9LiBJ12tvNArNmhd7EGMzh70HWwe8t9w4vpV2TBmdZSUD5vdac1nENcsJ8saySv79nrgnyUq2miZejc7eBJ5ae2wlVbzUyIpYV7Vxeqirh1DDiKTX4wPBeodEcJfmXlHluel4S1AgMBAAGjUzBRMB0GA1UdDgQWBBQ52KWubuPEi+92WakO2+rHz/PvUjAfBgNVHSMEGDAWgBQ52KWubuPEi+92WakO2+rHz/PvUjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQAJuDtWyrhm+VlGbazbCSiHNEA/yMoh9mGBbmtPx6Qqfzb1XT1bY3lAaLfkaoXXrvQwmswSCm88w8OUvi2HjDJj6I6735aQ41t+/gyIvAmPQ4YmN7AEeb4MqfLIcneTFEczTq7BQHbiOEY0AYHJ5UJ8z4pta7CjYTi13rFhF+Edpw7X2nVfxJuDR33wGJ9ixTEtIYXopKbqkoaBi0BSE8tnc91WI+8kZcu4wHfRP8WjedyLGKloFpczlGhaTyDeCA/Be4Jk6RkA3xZT0YdBld6Kk156iY4/lXZaEzy/HB2BEEwnIOFqHQvY+uCG/SmlNE43ZEf1dsgk3J6bmxpLOdjr -drive file=/usr/share/edk2-ovmf/UefiShell.img,format=raw,if=none,media=cdrom,id=drive-cd1,readonly=on -device ide-cd,drive=drive-cd1,id=cd1,bootindex=1

❯ ./ovmf-vars-generator --ovmf-binary /usr/share/edk2-ovmf/OVMF_CODE.secboot.fd --uefi-shell /usr/share/edk2-ovmf/UefiShell.img --ovmf-template-vars /usr/share/edk2-ovmf/OVMF_VARS.fd --enable-kvm --oem-string "$(< oem.str)" OVMF_VARS.secboot.fd
INFO:root:Starting enrollment
INFO:root:Performing enrollment

